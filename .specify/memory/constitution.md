<!--
Sync Impact Report
==================
- 版本变更: N/A → 1.0.0 (首次制定)
- 新增原则:
  1. Uni-app 跨平台统一
  2. uni-ui 组件规范
  3. pnpm 工程化管理
  4. 数据驱动学习闭环
  5. 渐进式交付
- 新增章节:
  - 技术约束
  - 开发工作流
  - 治理
- 移除章节: 无
- 模板同步状态:
  - .specify/templates/plan-template.md ✅ 无需修改（Constitution Check 已为动态引用）
  - .specify/templates/spec-template.md ✅ 无需修改（结构兼容）
  - .specify/templates/tasks-template.md ✅ 无需修改（阶段化结构兼容）
  - .specify/templates/checklist-template.md ✅ 无需修改
  - .specify/templates/agent-file-template.md ✅ 无需修改
  - CLAUDE.md ✅ 无需修改（语言指令一致）
- 延迟项: 无
-->

# The Lost Codex (失落法典) 项目宪法

## 核心原则

### I. Uni-app 跨平台统一

所有客户端功能开发 **必须 (MUST)** 基于 Uni-app 框架实现，确保一套代码在
微信小程序、H5、App（iOS/Android）等多端统一运行。

- 页面路由 **必须** 通过 `pages.json` 统一配置，禁止使用平台私有路由方案。
- 条件编译（`#ifdef`）**仅限** 处理不可避免的平台差异（如原生推送、支付），
  **禁止** 用于业务逻辑分叉。
- 所有新增页面 **必须** 在至少两个目标平台（H5 + 微信小程序）上验证通过后
  方可合并。

**理由**: 跨平台一致性是本项目触达最大用户群体的基础。任何平台私有依赖都会
增加维护成本并破坏统一体验。

### II. uni-ui 组件规范

界面布局与交互逻辑 **必须 (MUST)** 优先使用 uni-ui 官方组件库实现。

- 新增 UI 功能 **必须** 首先检查 uni-ui 是否提供对应组件，存在则 **必须**
  使用，**禁止** 重复造轮子。
- 自定义组件 **仅限** uni-ui 未覆盖的场景（如星图可视化、战斗动画），且
  **必须** 遵循 uni-ui 的命名规范（`uni-` 前缀保留给官方组件，自定义组件
  使用 `tlc-` 前缀）。
- 组件样式 **必须** 通过 uni-ui 的主题变量机制进行定制，**禁止** 直接覆写
  组件内部样式类。

**理由**: 统一组件库确保视觉一致性、降低维护成本，并获得官方持续更新支持。

### III. pnpm 工程化管理

项目 **必须 (MUST)** 使用 pnpm 作为唯一的包管理工具，用于依赖管理、脚本
执行和编译打包。

- 代码仓库 **必须** 包含 `pnpm-lock.yaml`，**禁止** 提交 `package-lock.json`
  或 `yarn.lock`。
- 所有构建、测试、部署脚本 **必须** 通过 `pnpm run <script>` 调用，
  **禁止** 直接使用 `npx` 或全局安装的 CLI 工具。
- 依赖安装 **必须** 使用 `pnpm install`，新增依赖 **必须** 区分
  `dependencies` 与 `devDependencies`。

**理由**: pnpm 的硬链接机制节省磁盘空间、加速安装，严格的依赖隔离防止
幽灵依赖（phantom dependencies）问题。

### IV. 数据驱动学习闭环

所有学习相关功能 **必须 (MUST)** 围绕 Mnemosyne 引擎的数据闭环设计，
确保用户行为数据实时反馈至调度算法。

- 每个用户交互（阅读、选择、战斗）**必须** 产生可量化的学习信号
  （反应时间、正确率、选择路径）。
- 学习信号 **必须** 在会话内实时更新单词生命周期状态（Lv.0-Lv.5），
  **禁止** 延迟批处理。
- AIGC 内容生成 **必须** 接受调度器指令（包含目标词汇及其等级），
  **禁止** 脱离调度器独立生成学习内容。

**理由**: 间隔重复的有效性取决于数据的实时性和准确性。任何断裂的数据环节
都会降低记忆效率。

### V. 渐进式交付

功能开发 **必须 (MUST)** 遵循 MVP 优先、增量交付的原则。

- 每个功能迭代 **必须** 产出可独立测试、可独立部署的交付物。
- 新功能 **必须** 先以最小可用形态上线验证，再根据数据反馈迭代增强。
- **禁止** 在单次迭代中同时开发超过一个核心引擎模块的全部功能。

**理由**: 渐进式交付降低集成风险，加速用户反馈循环，确保每次发布都有
明确可衡量的价值。

## 技术约束

- **运行时框架**: Uni-app（Vue 3 组合式 API）
- **UI 组件库**: uni-ui（官方组件库）
- **包管理器**: pnpm（版本 >= 8.0）
- **编程语言**: TypeScript（严格模式，`strict: true`）
- **状态管理**: Pinia（Uni-app 官方推荐）
- **网络请求**: uni.request 封装层（统一错误处理与鉴权拦截）
- **目标平台**: 微信小程序（主要）、H5（次要）、App（远期）
- **Node.js**: >= 18.0
- **代码风格**: ESLint + Prettier，提交前自动检查

## 开发工作流

- **分支策略**: 基于功能分支（feature branch）开发，合并前 **必须** 通过
  代码审查。
- **提交规范**: 使用 Conventional Commits 格式
  （`feat:`, `fix:`, `docs:`, `refactor:`, `test:` 等）。
- **构建验证**: 每次提交 **必须** 通过 `pnpm run build` 编译检查，
  确保多端产物无编译错误。
- **文档语言**: 所有项目文档（规格说明、计划、任务列表）**必须** 使用中文撰写。

## 治理

- 本宪法是项目的最高技术治理文件，所有开发实践 **必须** 与其保持一致。
- 修订流程：提出修订提案 → 记录变更理由 → 更新版本号 → 更新相关模板。
- 版本号遵循语义化版本规范：
  - **MAJOR**: 原则删除或不兼容的治理变更。
  - **MINOR**: 新增原则或实质性扩展。
  - **PATCH**: 措辞修正、排版优化。
- 合规检查：每次执行 `/speckit.plan` 时 **必须** 对照宪法原则进行
  Constitution Check，不通过则阻断后续阶段。

**Version**: 1.0.0 | **Ratified**: 2026-02-08 | **Last Amended**: 2026-02-08
